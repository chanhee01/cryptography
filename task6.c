#include <stdio.h>
#include <openssl/bn.h>

void printBN(char *msg, BIGNUM *a)
{
    char *number_str_a = BN_bn2hex(a);
    printf("%s %s\n", msg, number_str_a);
    OPENSSL_free(number_str_a);
}

int main()
{
    BN_CTX *ctx = BN_CTX_new();
    BIGNUM *n = BN_new();
    BIGNUM *e = BN_new();
    BIGNUM *M = BN_new();

    BIGNUM *C = BN_new();
    BIGNUM *S = BN_new();

    BN_hex2bn(&n, "C14BB3654770BCDD4F58DBEC9CEDC366E51F311354AD4A66461F2C0AEC6407E52EDCDCB90A20EDDFE3C4D09E9AA97A1D8288E51156DB1E9F58C251E72C340D2ED292E156CBF1795FB3BB87CA25037B9A52416610604F571349F0E8376783DFE7D34B674C2251A6DF0E9910ED57517426E27DC7CA622E131B7F238825536FC13458008B84FFF8BEA75849227B96ADA2889B15BCA07CDFE951A8D5B0ED37E236B4824B62B5499AECC767D6E33EF5E3D6125E44F1BF71427D58840380B18101FAF9CA32BBB48E278727C52B74D4A8D697DEC364F9CACE53A256BC78178E490329AEFB494FA415B9CEF25C19576D6B79A72BA2272013B5D03D40D321300793EA99F5");
    BN_dec2bn(&e, "65537");
    BN_hex2bn(&M, "01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF003031300D060960864801650304020105000420d1af33bf6a1580f19c548d431bf9acf62731b7a75846ee0b3e0e227a1878a81c");

    BN_hex2bn(&S, "551c9ddca5d3aa185c5886a2c6594646e31484685e7ffd2c66f83373d9d53059fd9151c039d8b1eb675555a07db6fe388fbe7081d86061ae4db7c8af9598de209d73b5bb73471b0388f10f9ffd6c4458b719c7df6ffab9a4c5269e00b7c3a44c73727e54a127af7ecf6df2be9e0ef92f79452a68d478bf63de4c9fa74e6303ce53c2ac0362790adbf25ea5230352c68d741e7bbd616c3ad4dc1ea6a15f006df1d22a6323c620c8b4f0df6c37116a684d52d0b3c3b2095291fd539538c018d125bfe2b36b591b6b4a14808fb252b38314584174cefc7c0ea13965bb3fa2f7af087db03dd2857b9d383cf4fe2c9e35044b0d7ef24e17f908e99c2ca77ea7cec148");

    BN_mod_exp(C, S, e, n, ctx);
    printBN("Original Message : ", M);
    printBN("Value of computed : ", C);

    if (BN_cmp(C, M) == 0)
    {
        printf("Valid Signature! \n");
    }
    else
    {
        printf("Verification fails! \n");
    }

    return 0;
}